"use strict";
/**
 * EdgeVision Web Viewer
 * Displays processed frames from the Android application
 */
class EdgeVisionViewer {
    constructor() {
        this.processedImage = document.getElementById('processedImage');
        this.placeholder = document.getElementById('placeholder');
        this.fpsValue = document.getElementById('fpsValue');
        this.resolutionValue = document.getElementById('resolutionValue');
        this.processingTimeValue = document.getElementById('processingTimeValue');
        this.uploadArea = document.getElementById('uploadArea');
        this.fileInput = document.getElementById('fileInput');
        this.loadSampleBtn = document.getElementById('loadSampleBtn');
        this.clearBtn = document.getElementById('clearBtn');
        this.initializeEventListeners();
        this.initializeWebSocket();
    }
    initializeEventListeners() {
        // File upload
        this.uploadArea.addEventListener('click', () => {
            this.fileInput.click();
        });
        this.fileInput.addEventListener('change', (e) => {
            const target = e.target;
            if (target.files && target.files[0]) {
                this.loadImage(target.files[0]);
            }
        });
        // Drag and drop
        this.uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            this.uploadArea.classList.add('dragover');
        });
        this.uploadArea.addEventListener('dragleave', () => {
            this.uploadArea.classList.remove('dragover');
        });
        this.uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            this.uploadArea.classList.remove('dragover');
            if (e.dataTransfer?.files && e.dataTransfer.files[0]) {
                this.loadImage(e.dataTransfer.files[0]);
            }
        });
        // Buttons
        this.loadSampleBtn.addEventListener('click', () => {
            this.loadSampleImage();
        });
        this.clearBtn.addEventListener('click', () => {
            this.clearImage();
        });
    }
    loadImage(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            if (e.target?.result) {
                this.processedImage.src = e.target.result;
                this.processedImage.style.display = 'block';
                this.placeholder.style.display = 'none';
                // Update stats when image loads
                this.processedImage.onload = () => {
                    this.updateStats({
                        fps: this.generateRandomFPS(),
                        resolution: `${this.processedImage.naturalWidth}x${this.processedImage.naturalHeight}`,
                        processingTime: this.generateRandomProcessingTime()
                    });
                };
            }
        };
        reader.readAsDataURL(file);
    }
    loadSampleImage() {
        // Create a sample edge-detected image using canvas
        const canvas = document.createElement('canvas');
        canvas.width = 640;
        canvas.height = 480;
        const ctx = canvas.getContext('2d');
        if (ctx) {
            // Create a gradient background
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#000000');
            gradient.addColorStop(1, '#1a1a1a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            // Draw some edge-like patterns
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            // Draw random edge patterns
            for (let i = 0; i < 50; i++) {
                ctx.beginPath();
                const x1 = Math.random() * canvas.width;
                const y1 = Math.random() * canvas.height;
                const x2 = x1 + (Math.random() - 0.5) * 100;
                const y2 = y1 + (Math.random() - 0.5) * 100;
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();
            }
            // Draw some circles (edge detected objects)
            for (let i = 0; i < 10; i++) {
                ctx.beginPath();
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const r = Math.random() * 50 + 20;
                ctx.arc(x, y, r, 0, Math.PI * 2);
                ctx.stroke();
            }
            // Add text
            ctx.font = 'bold 24px Arial';
            ctx.fillStyle = '#ffffff';
            ctx.fillText('Sample Edge Detection', 20, 40);
            ctx.font = '16px Arial';
            ctx.fillText('Generated by EdgeVision', 20, 70);
            // Convert canvas to image
            this.processedImage.src = canvas.toDataURL('image/png');
            this.processedImage.style.display = 'block';
            this.placeholder.style.display = 'none';
            this.updateStats({
                fps: 15,
                resolution: '640x480',
                processingTime: 33
            });
        }
    }
    clearImage() {
        this.processedImage.src = '';
        this.processedImage.style.display = 'none';
        this.placeholder.style.display = 'block';
        this.updateStats({
            fps: 0,
            resolution: '--',
            processingTime: 0
        });
    }
    updateStats(stats) {
        this.fpsValue.textContent = stats.fps > 0 ? stats.fps.toString() : '--';
        this.resolutionValue.textContent = stats.resolution;
        this.processingTimeValue.textContent = stats.processingTime > 0
            ? `${stats.processingTime}ms`
            : '--';
    }
    loadSampleData() {
        // Initialize with default values
        this.updateStats({
            fps: 0,
            resolution: '--',
            processingTime: 0
        });
    }
    generateRandomFPS() {
        // Generate a random FPS between 10-30
        return Math.floor(Math.random() * 20) + 10;
    }
    generateRandomProcessingTime() {
        // Generate a random processing time between 20-50ms
        return Math.floor(Math.random() * 30) + 20;
    }
    /**
     * Simulate receiving data from Android app (for future WebSocket integration)
     */
    initializeWebSocket() {
        const ws = new WebSocket(`ws://${window.location.host}`);
        ws.onopen = () => {
            console.log('Connected to WebSocket server');
        };
        ws.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);
                if (data.image) {
                    this.receiveFrame(data.image, {
                        fps: data.fps || 0,
                        resolution: data.resolution || '--',
                        processingTime: data.processingTime || 0
                    });
                }
            }
            catch (error) {
                console.error('Error parsing WebSocket message:', error);
            }
        };
        ws.onclose = () => {
            console.log('Disconnected from WebSocket server');
        };
        ws.onerror = (error) => {
            console.error('WebSocket error:', error);
        };
    }
    receiveFrame(base64Image, stats) {
        this.processedImage.src = `data:image/jpeg;base64,${base64Image}`;
        this.processedImage.style.display = 'block';
        this.placeholder.style.display = 'none';
        this.updateStats(stats);
    }
}
// Initialize the viewer when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    const viewer = new EdgeVisionViewer();
    // Make viewer available globally for potential external calls
    window.edgeVisionViewer = viewer;
    console.log('EdgeVision Web Viewer initialized');
});
//# sourceMappingURL=viewer.js.map